{"filter":false,"title":"views.py","tooltip":"/storyteller_app/views.py","undoManager":{"mark":40,"position":40,"stack":[[{"start":{"row":0,"column":0},"end":{"row":0,"column":1},"action":"insert","lines":["u"],"id":632}],[{"start":{"row":0,"column":1},"end":{"row":0,"column":2},"action":"insert","lines":["u"],"id":633}],[{"start":{"row":0,"column":2},"end":{"row":0,"column":3},"action":"insert","lines":["u"],"id":634}],[{"start":{"row":0,"column":3},"end":{"row":0,"column":4},"action":"insert","lines":["u"],"id":635}],[{"start":{"row":0,"column":4},"end":{"row":0,"column":5},"action":"insert","lines":["u"],"id":636}],[{"start":{"row":0,"column":5},"end":{"row":0,"column":6},"action":"insert","lines":["u"],"id":637}],[{"start":{"row":0,"column":6},"end":{"row":0,"column":7},"action":"insert","lines":["u"],"id":638}],[{"start":{"row":0,"column":7},"end":{"row":0,"column":8},"action":"insert","lines":["u"],"id":639}],[{"start":{"row":0,"column":5},"end":{"row":0,"column":8},"action":"remove","lines":["uuu"],"id":640,"ignore":true}],[{"start":{"row":0,"column":0},"end":{"row":0,"column":5},"action":"remove","lines":["uuuuu"],"id":641,"ignore":true}],[{"start":{"row":0,"column":0},"end":{"row":0,"column":1},"action":"insert","lines":["e"],"id":642,"ignore":true}],[{"start":{"row":0,"column":1},"end":{"row":0,"column":3},"action":"insert","lines":["ee"],"id":643,"ignore":true}],[{"start":{"row":0,"column":3},"end":{"row":0,"column":5},"action":"insert","lines":["ee"],"id":644,"ignore":true}],[{"start":{"row":0,"column":5},"end":{"row":0,"column":6},"action":"insert","lines":["e"],"id":645,"ignore":true}],[{"start":{"row":0,"column":6},"end":{"row":0,"column":9},"action":"insert","lines":["eee"],"id":646,"ignore":true}],[{"start":{"row":0,"column":9},"end":{"row":0,"column":12},"action":"insert","lines":["eee"],"id":647,"ignore":true}],[{"start":{"row":0,"column":0},"end":{"row":1,"column":0},"action":"insert","lines":["",""],"id":648}],[{"start":{"row":0,"column":0},"end":{"row":0,"column":1},"action":"insert","lines":["t"],"id":649}],[{"start":{"row":0,"column":1},"end":{"row":0,"column":2},"action":"insert","lines":["t"],"id":650}],[{"start":{"row":1,"column":12},"end":{"row":1,"column":15},"action":"insert","lines":["fgh"],"id":651,"ignore":true}],[{"start":{"row":1,"column":15},"end":{"row":1,"column":17},"action":"insert","lines":["fh"],"id":652,"ignore":true}],[{"start":{"row":0,"column":2},"end":{"row":0,"column":3},"action":"insert","lines":["t"],"id":653}],[{"start":{"row":0,"column":3},"end":{"row":0,"column":4},"action":"insert","lines":["t"],"id":654}],[{"start":{"row":0,"column":4},"end":{"row":0,"column":5},"action":"insert","lines":["t"],"id":655}],[{"start":{"row":0,"column":5},"end":{"row":0,"column":6},"action":"insert","lines":["t"],"id":656}],[{"start":{"row":1,"column":17},"end":{"row":1,"column":21},"action":"insert","lines":["fhfg"],"id":657,"ignore":true}],[{"start":{"row":0,"column":6},"end":{"row":0,"column":7},"action":"insert","lines":["t"],"id":658}],[{"start":{"row":0,"column":7},"end":{"row":0,"column":8},"action":"insert","lines":["t"],"id":659}],[{"start":{"row":0,"column":8},"end":{"row":0,"column":9},"action":"insert","lines":["t"],"id":660}],[{"start":{"row":0,"column":9},"end":{"row":0,"column":10},"action":"insert","lines":["t"],"id":661}],[{"start":{"row":0,"column":0},"end":{"row":1,"column":21},"action":"remove","lines":["tttttttttt","eeeeeeeeeeeefghfhfhfg"],"id":662,"ignore":true}],[{"start":{"row":0,"column":0},"end":{"row":0,"column":3},"action":"insert","lines":["王釧茹"],"id":663}],[{"start":{"row":0,"column":2},"end":{"row":0,"column":3},"action":"remove","lines":["茹"],"id":664}],[{"start":{"row":0,"column":1},"end":{"row":0,"column":2},"action":"remove","lines":["釧"],"id":665}],[{"start":{"row":0,"column":0},"end":{"row":0,"column":1},"action":"remove","lines":["王"],"id":666}],[{"start":{"row":0,"column":0},"end":{"row":241,"column":4},"action":"insert","lines":["from django.shortcuts import render","from django.shortcuts import render_to_response","from django.shortcuts import redirect","from django.core.urlresolvers import reverse","# Create your views here.","from .forms import AddForm, AddForm2, userForm","from .models import Story, Post, User","from django.http import HttpResponseRedirect","from time import localtime,strftime","from django.db.models import F","","#global","","    ","        ","def story(request, pk):","    ","    check_pk = pk","    ","    if request.method == 'POST':","        ","        django_form = AddForm(request.POST)","        if django_form.is_valid():","            new_context = django_form.data.get(\"context\")","            ","            Story.objects.create(","                context =  new_context, ","                auther = \"auther\",","                time = strftime(\"%Y %b %d %X\",localtime()),","                post_id = check_pk,","                likes = 0,","                )","                ","            ","            ","            #url = reverse('story', kwargs={'story': check_pk})","            #return HttpResponseRedirect(url)","            story_list = Story.objects.filter(post_id=check_pk).all()","            post_story = Post.objects.get(pk=check_pk)","            #return render(request, 'storyteller_app/story.html',{'story': story_list, 'post': post_story})","            ","            intopk = Story.objects.get(pk=check_pk)","            return redirect(\"story\",intopk.post_id)","            ","        ","        else:","            #return HttpResponseRedirect(request, 'mycontacts/show.html',{'story': story_list})   ","            #url = reverse('story', kwargs={'story': check_pk})","            #return HttpResponseRedirect(url)","            story_list = Story.objects.filter(post_id=check_pk).all()","            post_story = Post.objects.get(pk=check_pk)","            return render(request, 'storyteller_app/story.html',{'story': story_list, 'post': post_story})","    ","    else:","        story_list = Story.objects.filter(post_id=check_pk).all()","        post_story = Post.objects.get(pk=check_pk)","        ","        return render(request, 'storyteller_app/story.html',{'story': story_list, 'post': post_story})"," "," "," "," "," "," "," ","        ","def likes(request, pk):","    ","    temp_pk = pk","    ","    Story.objects.filter(pk=temp_pk).update(likes = F('likes')+1)","    intopk = Story.objects.get(pk=temp_pk)","    ","    return redirect(\"story\",intopk.post_id)","    ","    ","    ","    ","    ","    ","    ","def collection_e(request):","    ","    post_list  = Post.objects.all()","    ","    return render(request,'storyteller_app/collection_e.html',{","        'post_list': post_list,","    })","    ","  ","  ","  "," ","  ","  ","    ","def collection_f(request):","    ","    return render(request,'storyteller_app/collection_f.html')","    ","    ","    ","    ","    ","    ","    ","    ","def addpost(request):","    ","    post_list  = Post.objects.all()","","    if request.method == 'POST':","        ","        django_form = AddForm2(request.POST)","        if django_form.is_valid():","            new_title = django_form.data.get(\"new-title\")","            first_sentence = django_form.data.get(\"first-sentence\")","            ","            Post.objects.create(","                storyTitle = new_title,","                created_at = strftime(\"%Y %b %d\",localtime()),","                created_day = strftime(\"%d\",localtime()),","                created_mon = strftime(\"%b\",localtime()),","                post_likes = 0,","                firstSentence = first_sentence,","            )","            ","            intopk = Post.objects.get(storyTitle=new_title)","            ","            Story.objects.create(","                context =  first_sentence, ","                auther = \"auther\",","                time = strftime(\"%Y %b %d %X\",localtime()),","                post_id = intopk.pk,","                likes = 0,","                )","            ","","            return redirect(\"story\",intopk.pk)","        ","        else:","            post_list  = Post.objects.all()","            return render(request,'storyteller_app/collection_e.html',{'post': post_list})","    ","    else:","        post_list  = Post.objects.all()","        return render(request,'storyteller_app/collection_e.html',{'post': post_list})","","","","","","","","","def index(request):","    return render(request,'storyteller_app/index.html')"," "," "," "," "," "," "," ","    ","","def post_likes(request, pk):","    ","    temp_pk = pk","    ","    Post.objects.filter(pk=temp_pk).update(post_likes = F('post_likes')+1)","    ","    post_list  = Post.objects.all()","    ","    ","    return render(request, 'storyteller_app/collection_e.html',{'post_list': post_list })","    ","   ","   ","def in_post_likes(request, pk):","    ","    temp_pk = pk","    ","    Post.objects.filter(pk=temp_pk).update(post_likes = F('post_likes')+1)","    ","    intopk = Story.objects.get(pk=temp_pk)","    return redirect(\"story\",intopk.post_id)","    "," "," "," ","    ","    ","def hot_sort(request):","    ","    ","    post_list = Post.objects.all().order_by('-post_likes')","    ","    return render(request, 'storyteller_app/collection_e.html',{'post_list': post_list})","","","    ","    ","    ","    ","    ","def new_sort(request):","    ","    post_list = Post.objects.all().order_by('-pk')","    ","    return render(request, 'storyteller_app/collection_e.html',{'post_list': post_list})","    ","  ","  ","  ","  ","  ","def adduser(request):","    if request.method == 'POST':","        ","        django_form = userForm(request.POST)","        if django_form.is_valid():","            ","            new_name = django_form.data.get(\"name\")","            new_account = django_form.data.get(\"account\")","            new_password = django_form.data.get(\"password\")","            ","            User.objects.create(","                name = new_name,","                account = new_account,","                password = new_password,","            )","","            return HttpResponseRedirect(\"/\")","        ","        else:","            return HttpResponseRedirect(\"/\")","    ","    else:","        return HttpResponseRedirect(\"/\")","","    "],"id":667}],[{"start":{"row":185,"column":4},"end":{"row":185,"column":42},"action":"remove","lines":["intopk = Story.objects.get(pk=temp_pk)"],"id":668}],[{"start":{"row":181,"column":16},"end":{"row":182,"column":0},"action":"insert","lines":["",""],"id":669},{"start":{"row":182,"column":0},"end":{"row":182,"column":4},"action":"insert","lines":["    "]}],[{"start":{"row":182,"column":4},"end":{"row":182,"column":42},"action":"insert","lines":["intopk = Story.objects.get(pk=temp_pk)"],"id":670}],[{"start":{"row":186,"column":0},"end":{"row":186,"column":4},"action":"remove","lines":["    "],"id":671}],[{"start":{"row":185,"column":4},"end":{"row":186,"column":0},"action":"remove","lines":["",""],"id":672}]]},"ace":{"folds":[],"scrolltop":2685,"scrollleft":0,"selection":{"start":{"row":182,"column":0},"end":{"row":183,"column":0},"isBackwards":false},"options":{"guessTabSize":true,"useWrapMode":false,"wrapToView":true},"firstLineState":{"row":166,"state":"start","mode":"ace/mode/python"}},"timestamp":1482153141254,"hash":"ae3892eeee6926ca73f42c47f3db117a80e4d823"}